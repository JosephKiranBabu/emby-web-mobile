define(["connectionManager","globalize","dom","paper-icon-button-light","material-icons","emby-button","css!./userdatabuttons"],function(connectionManager,globalize,dom){function getUserDataButtonHtml(method,itemId,buttonCssClass,iconCssClass,icon,tooltip,style){"fab-mini"==style&&(style="fab",buttonCssClass=buttonCssClass?buttonCssClass+" mini":"mini");var is="fab"==style?"emby-button":"paper-icon-button-light",className="fab"==style?"autoSize fab":"autoSize";return buttonCssClass&&(className+=" "+buttonCssClass),iconCssClass?iconCssClass+=" ":iconCssClass="",iconCssClass+="md-icon",'<button title="'+tooltip+'" data-itemid="'+itemId+'" is="'+is+'" data-method="'+method+'" class="'+className+'">                <i class="'+iconCssClass+'">'+icon+"</i>            </button>"}function onContainerClick(e){var btnUserData=dom.parentWithClass(e.target,"btnUserData");if(btnUserData){var method=btnUserData.getAttribute("data-method");userDataMethods[method](btnUserData)}}function fill(options){var html=getIconsHtml(options);"insertAdjacent"==options.fillMode?options.element.insertAdjacentHTML(options.insertLocation||"beforeend",html):options.element.innerHTML=html,dom.removeEventListener(options.element,"click",onContainerClick,{passive:!0}),dom.addEventListener(options.element,"click",onContainerClick,{passive:!0})}function destroy(options){options.element.innerHTML="",dom.removeEventListener(options.element,"click",onContainerClick,{passive:!0})}function getIconsHtml(options){var item=options.item,includePlayed=options.includePlayed,cssClass=options.cssClass,style=options.style,html="",userData=item.UserData||{},itemId=item.Id,btnCssClass="btnUserData";cssClass&&(btnCssClass+=" "+cssClass);var iconCssClass=options.iconCssClass;if(includePlayed!==!1){var tooltipPlayed=globalize.translate("sharedcomponents#MarkPlayed");"Video"!=item.MediaType&&"Series"!=item.Type&&"Season"!=item.Type&&"BoxSet"!=item.Type&&"Playlist"!=item.Type||"TvChannel"!=item.Type&&(html+=userData.Played?getUserDataButtonHtml("markPlayed",itemId,btnCssClass+" btnUserDataOn",iconCssClass,"check",tooltipPlayed,style):getUserDataButtonHtml("markPlayed",itemId,btnCssClass,iconCssClass,"check",tooltipPlayed,style))}var tooltipFavorite=globalize.translate("sharedcomponents#Favorite");return html+=userData.IsFavorite?getUserDataButtonHtml("markFavorite",itemId,btnCssClass+" btnUserData btnUserDataOn",iconCssClass,"favorite",tooltipFavorite,style):getUserDataButtonHtml("markFavorite",itemId,btnCssClass+" btnUserData",iconCssClass,"favorite",tooltipFavorite,style)}function markFavorite(link){var id=link.getAttribute("data-itemid"),markAsFavorite=!link.classList.contains("btnUserDataOn");favorite(id,markAsFavorite),markAsFavorite?link.classList.add("btnUserDataOn"):link.classList.remove("btnUserDataOn")}function markLike(link){var id=link.getAttribute("data-itemid");link.classList.contains("btnUserDataOn")?(clearLike(id),link.classList.remove("btnUserDataOn")):(likes(id,!0),link.classList.add("btnUserDataOn")),link.parentNode.querySelector(".btnDislike").classList.remove("btnUserDataOn")}function markDislike(link){var id=link.getAttribute("data-itemid");link.classList.contains("btnUserDataOn")?(clearLike(id),link.classList.remove("btnUserDataOn")):(likes(id,!1),link.classList.add("btnUserDataOn")),link.parentNode.querySelector(".btnLike").classList.remove("btnUserDataOn")}function markPlayed(link){var id=link.getAttribute("data-itemid");link.classList.contains("btnUserDataOn")?(played(id,!1),link.classList.remove("btnUserDataOn")):(played(id,!0),link.classList.add("btnUserDataOn"))}function likes(id,isLiked){var apiClient=connectionManager.currentApiClient();return apiClient.updateUserItemRating(apiClient.getCurrentUserId(),id,isLiked)}function played(id,isPlayed){var apiClient=connectionManager.currentApiClient(),method=isPlayed?"markPlayed":"markUnplayed";return apiClient[method](apiClient.getCurrentUserId(),id,new Date)}function favorite(id,isFavorite){var apiClient=connectionManager.currentApiClient();return apiClient.updateFavoriteStatus(apiClient.getCurrentUserId(),id,isFavorite)}function clearLike(id){var apiClient=connectionManager.currentApiClient();return apiClient.clearUserItemRating(apiClient.getCurrentUserId(),id)}var userDataMethods={markPlayed:markPlayed,markDislike:markDislike,markLike:markLike,markFavorite:markFavorite};return{fill:fill,destroy:destroy,getIconsHtml:getIconsHtml}});
define(["browser","css!./viewcontainer-lite"],function(browser){function enableAnimation(){return!!browser.animate||!browser.tv&&(!browser.operaTv&&(browser.edge&&!browser.mobile))}function loadView(options){if(!options.cancel){cancelActiveAnimations();var selected=selectedPageIndex,previousAnimatable=selected==-1?null:allPages[selected],pageIndex=selected+1;pageIndex>=pageContainerCount&&(pageIndex=0);var view=document.createElement("div");options.type&&view.setAttribute("data-type",options.type),view.innerHTML=options.view;var currentPage=allPages[pageIndex],animatable=view;return view.classList.add("mainAnimatedPage"),currentPage?(triggerDestroy(currentPage),mainAnimatedPages.replaceChild(view,currentPage)):mainAnimatedPages.appendChild(view),allPages[pageIndex]=view,onBeforeChange&&onBeforeChange(view,!1,options),beforeAnimate(allPages,pageIndex,selected),animate(animatable,previousAnimatable,options.transition,options.isBack).then(function(){return selectedPageIndex=pageIndex,currentUrls[pageIndex]=options.url,!options.cancel&&previousAnimatable&&afterAnimate(allPages,pageIndex),view})}}function beforeAnimate(allPages,newPageIndex,oldPageIndex){for(var i=0,length=allPages.length;i<length;i++)newPageIndex==i||oldPageIndex==i||allPages[i].classList.add("hide")}function afterAnimate(allPages,newPageIndex){for(var i=0,length=allPages.length;i<length;i++)newPageIndex==i||allPages[i].classList.add("hide")}function animate(newAnimatedPage,oldAnimatedPage,transition,isBack){if(enableAnimation()&&oldAnimatedPage&&newAnimatedPage.animate){if("slide"==transition)return slide(newAnimatedPage,oldAnimatedPage,transition,isBack);if("fade"==transition)return fade(newAnimatedPage,oldAnimatedPage,transition,isBack)}return Promise.resolve()}function slide(newAnimatedPage,oldAnimatedPage,transition,isBack){return new Promise(function(resolve,reject){var timings={duration:450,iterations:1,easing:"ease-out",fill:"both"},animations=[];if(oldAnimatedPage){var destination=isBack?"100%":"-100%";animations.push(oldAnimatedPage.animate([{transform:"none",offset:0},{transform:"translate3d("+destination+", 0, 0)",offset:1}],timings))}var start=isBack?"-100%":"100%";animations.push(newAnimatedPage.animate([{transform:"translate3d("+start+", 0, 0)",offset:0},{transform:"none",offset:1}],timings)),currentAnimations=animations,animations[animations.length-1].onfinish=resolve})}function fade(newAnimatedPage,oldAnimatedPage,transition,isBack){return new Promise(function(resolve,reject){var timings={duration:300,iterations:1,easing:"ease-out",fill:"both"},animations=[];oldAnimatedPage&&animations.push(oldAnimatedPage.animate([{opacity:1,offset:0},{opacity:0,offset:1}],timings)),animations.push(newAnimatedPage.animate([{opacity:0,offset:0},{opacity:1,offset:1}],timings)),currentAnimations=animations,animations[animations.length-1].onfinish=resolve})}function cancelActiveAnimations(){for(var animations=currentAnimations,i=0,length=animations.length;i<length;i++)cancelAnimation(animations[i])}function cancelAnimation(animation){try{animation.cancel()}catch(err){console.log("Error canceling animation: "+err)}}function setOnBeforeChange(fn){onBeforeChange=fn}function tryRestoreView(options){var url=options.url,index=currentUrls.indexOf(url);if(index!=-1){var animatable=allPages[index],view=animatable;if(view){if(options.cancel)return;cancelActiveAnimations();var selected=selectedPageIndex,previousAnimatable=selected==-1?null:allPages[selected];return onBeforeChange&&onBeforeChange(view,!0,options),beforeAnimate(allPages,index,selected),animatable.classList.remove("hide"),animate(animatable,previousAnimatable,options.transition,options.isBack).then(function(){return selectedPageIndex=index,!options.cancel&&previousAnimatable&&afterAnimate(allPages,index),view})}}return Promise.reject()}function triggerDestroy(view){view.dispatchEvent(new CustomEvent("viewdestroy",{cancelable:!1}))}function reset(){allPages=[],currentUrls=[],mainAnimatedPages.innerHTML="",selectedPageIndex=-1}var onBeforeChange,mainAnimatedPages=document.querySelector(".mainAnimatedPages"),allPages=[],currentUrls=[],pageContainerCount=3,selectedPageIndex=-1,currentAnimations=[];return enableAnimation()&&require(["webAnimations"]),{loadView:loadView,tryRestoreView:tryRestoreView,reset:reset,setOnBeforeChange:setOnBeforeChange}});
define(["layoutManager","cardBuilder","datetime","mediaInfo","backdrop","listView","itemContextMenu","itemHelper","userdataButtons","dom","indicators","apphost","scrollStyles","emby-itemscontainer","emby-checkbox"],function(layoutManager,cardBuilder,datetime,mediaInfo,backdrop,listView,itemContextMenu,itemHelper,userdataButtons,dom,indicators,appHost){function getPromise(params){var id=params.id;if(id)return ApiClient.getItem(Dashboard.getCurrentUserId(),id);var name=params.genre;if(name)return ApiClient.getGenre(name,Dashboard.getCurrentUserId());if(name=params.musicgenre)return ApiClient.getMusicGenre(name,Dashboard.getCurrentUserId());if(name=params.gamegenre)return ApiClient.getGameGenre(name,Dashboard.getCurrentUserId());if(name=params.musicartist)return ApiClient.getArtist(name,Dashboard.getCurrentUserId());throw new Error("Invalid request")}function reload(page,params){Dashboard.showLoadingMsg(),getPromise(params).then(function(item){reloadFromItem(page,params,item)})}function hideAll(page,className,show){var i,length,elems=page.querySelectorAll("."+className);for(i=0,length=elems.length;i<length;i++)show?elems[i].classList.remove("hide"):elems[i].classList.add("hide")}function getContextMenuOptions(item,button){var options={item:item,open:!1,play:!1,queue:!1,playAllFromHere:!1,queueAllFromHere:!1,positionTo:button};return appHost.supports("sync")?options.syncLocal=!1:options.sync=!1,options}function updateSyncStatus(page,item){var i,length,elems=page.querySelectorAll(".chkOffline");for(i=0,length=elems.length;i<length;i++)elems[i].checked=null!=item.SyncPercent}function reloadFromItem(page,params,item){currentItem=item;var context=params.context;LibraryBrowser.renderName(item,page.querySelector(".itemName"),!1,context),LibraryBrowser.renderParentName(item,page.querySelector(".parentName"),context),LibraryMenu.setTitle(""),Dashboard.getCurrentUser().then(function(user){window.scrollTo(0,0),renderImage(page,item,user),setInitialCollapsibleState(page,item,context,user),renderDetails(page,item,context);var hasBackdrop=!1;if("MusicArtist"!=item.Type&&"MusicAlbum"!=item.Type&&"Playlist"!=item.Type&&"BoxSet"!=item.Type&&"Audio"!=item.MediaType&&layoutManager.mobile)hasBackdrop=LibraryBrowser.renderDetailPageBackdrop(page,item),backdrop.clear();else{var itemBackdropElement=page.querySelector("#itemBackdrop");itemBackdropElement.classList.add("noBackdrop"),itemBackdropElement.style.backgroundImage="none",backdrop.setBackdrops([item])}var transparentHeader=hasBackdrop&&page.classList.contains("noSecondaryNavPage");LibraryMenu.setTransparentMenu(transparentHeader);var canPlay=!1;if("Program"==item.Type){var now=new Date;now>=datetime.parseISO8601Date(item.StartDate,!0)&&now<datetime.parseISO8601Date(item.EndDate,!0)?(hideAll(page,"btnPlay",!0),canPlay=!0):hideAll(page,"btnPlay")}else MediaController.canPlay(item)?(hideAll(page,"btnPlay",!0),canPlay=!0):hideAll(page,"btnPlay");item.LocalTrailerCount&&"Full"==item.PlayAccess?hideAll(page,"btnPlayTrailer",!0):hideAll(page,"btnPlayTrailer"),itemHelper.canSync(user,item)?(appHost.supports("sync")?(hideAll(page,"syncLocalContainer",!0),hideAll(page,"btnSync")):(hideAll(page,"syncLocalContainer"),hideAll(page,"btnSync",!0)),updateSyncStatus(page,item)):(hideAll(page,"btnSync"),hideAll(page,"syncLocalContainer")),showRecordingFields(page,item,user);for(var btnPlayExternalTrailer=page.querySelectorAll(".btnPlayExternalTrailer"),i=0,length=btnPlayExternalTrailer.length;i<length;i++)!item.LocalTrailerCount&&item.RemoteTrailers.length&&"Full"==item.PlayAccess?(btnPlayExternalTrailer[i].classList.remove("hide"),btnPlayExternalTrailer[i].href=item.RemoteTrailers[0].Url):(btnPlayExternalTrailer[i].classList.add("hide"),btnPlayExternalTrailer[i].href="#");var groupedVersions=(item.MediaSources||[]).filter(function(g){return"Grouping"==g.Type});user.Policy.IsAdministrator&&groupedVersions.length?page.querySelector(".splitVersionContainer").classList.remove("hide"):page.querySelector(".splitVersionContainer").classList.add("hide"),itemContextMenu.getCommands(getContextMenuOptions(item)).then(function(commands){commands.length?hideAll(page,"btnMoreCommands",!0):hideAll(page,"btnMoreCommands")});var itemBirthday=page.querySelector("#itemBirthday");if("Person"==item.Type&&item.PremiereDate)try{var birthday=datetime.parseISO8601Date(item.PremiereDate,!0).toDateString();itemBirthday.classList.remove("hide"),itemBirthday.innerHTML=Globalize.translate("BirthDateValue").replace("{0}",birthday)}catch(err){itemBirthday.classList.add("hide")}else itemBirthday.classList.add("hide");var itemDeathDate=page.querySelector("#itemDeathDate");if("Person"==item.Type&&item.EndDate)try{var deathday=datetime.parseISO8601Date(item.EndDate,!0).toDateString();itemDeathDate.classList.remove("hide"),itemDeathDate.innerHTML=Globalize.translate("DeathDateValue").replace("{0}",deathday)}catch(err){itemDeathDate.classList.add("hide")}var itemBirthLocation=page.querySelector("#itemBirthLocation");if("Person"==item.Type&&item.ProductionLocations&&item.ProductionLocations.length){var gmap='<a class="textlink" target="_blank" href="https://maps.google.com/maps?q='+item.ProductionLocations[0]+'">'+item.ProductionLocations[0]+"</a>";itemBirthLocation.classList.remove("hide"),itemBirthLocation.innerHTML=Globalize.translate("BirthPlaceValue").replace("{0}",gmap)}else itemBirthLocation.classList.add("hide")});var isMissingEpisode=!1;if("Virtual"==item.LocationType&&"Episode"==item.Type)try{item.PremiereDate&&(new Date).getTime()>=datetime.parseISO8601Date(item.PremiereDate,!0).getTime()&&(isMissingEpisode=!0)}catch(err){}setPeopleHeader(page,item),page.dispatchEvent(new CustomEvent("displayingitem",{detail:{item:item,context:context},bubbles:!0})),Dashboard.hideLoadingMsg()}function showRecordingFields(page,item,user){if(!currentRecordingFields){var recordingFieldsElement=page.querySelector(".recordingFields");"Program"==item.Type&&user.Policy.EnableLiveTvManagement?require(["recordingFields"],function(recordingFields){currentRecordingFields=new recordingFields({parent:recordingFieldsElement,programId:item.Id,serverId:item.ServerId}),recordingFieldsElement.classList.remove("hide")}):(recordingFieldsElement.classList.add("hide"),recordingFieldsElement.innerHTML="")}}function renderLinks(linksElem,item){var links=[];if(item.HomePageUrl&&links.push('<a class="textlink" href="'+item.HomePageUrl+'" target="_blank">'+Globalize.translate("ButtonWebsite")+"</a>"),item.ExternalUrls)for(var i=0,length=item.ExternalUrls.length;i<length;i++){var url=item.ExternalUrls[i];links.push('<a class="textlink" href="'+url.Url+'" target="_blank">'+url.Name+"</a>")}if(links.length){var html=links.join("&nbsp;&nbsp;/&nbsp;&nbsp;");html=Globalize.translate("ValueLinks",html),linksElem.innerHTML=html,linksElem.classList.remove("hide")}else linksElem.classList.add("hide")}function renderImage(page,item,user){LibraryBrowser.renderDetailImage(page.querySelector(".detailImageContainer"),item,user.Policy.IsAdministrator&&"Photo"!=item.MediaType)}function refreshDetailImageUserData(elem,item){var detailImageProgressContainer=elem.querySelector(".detailImageProgressContainer");detailImageProgressContainer.innerHTML=indicators.getProgressBarHtml(item)}function refreshImage(page,item,user){refreshDetailImageUserData(page.querySelector(".detailImageContainer"),item)}function setPeopleHeader(page,item){"Audio"==item.MediaType||"MusicAlbum"==item.Type||"Book"==item.MediaType||"Photo"==item.MediaType?page.querySelector("#peopleHeader").innerHTML=Globalize.translate("HeaderPeople"):page.querySelector("#peopleHeader").innerHTML=Globalize.translate("HeaderCastAndCrew")}function renderNextUp(page,item,user){var section=page.querySelector(".nextUpSection");return"Series"!=item.Type?void section.classList.add("hide"):void ApiClient.getNextUpEpisodes({SeriesId:item.Id,UserId:user.Id}).then(function(result){result.Items.length?section.classList.remove("hide"):section.classList.add("hide");var html=cardBuilder.getCardsHtml({items:result.Items,shape:getThumbShape(!1),showTitle:!0,displayAsSpecial:"Season"==item.Type&&item.IndexNumber,overlayText:!0,lazy:!0,overlayPlayButton:!0}),itemsContainer=section.querySelector(".nextUpItems");itemsContainer.innerHTML=html,ImageLoader.lazyChildren(itemsContainer)})}function setInitialCollapsibleState(page,item,context,user){page.querySelector(".collectionItems").innerHTML="","TvChannel"==item.Type?(page.querySelector("#childrenCollapsible").classList.remove("hide"),renderChannelGuide(page,item,user)):"Playlist"==item.Type?(page.querySelector("#childrenCollapsible").classList.remove("hide"),renderPlaylistItems(page,item,user)):"Studio"==item.Type||"Person"==item.Type||"Genre"==item.Type||"MusicGenre"==item.Type||"GameGenre"==item.Type||"MusicArtist"==item.Type?(page.querySelector("#childrenCollapsible").classList.remove("hide"),renderItemsByName(page,item,user)):item.IsFolder?("BoxSet"==item.Type?page.querySelector("#childrenCollapsible").classList.add("hide"):page.querySelector("#childrenCollapsible").classList.remove("hide"),renderChildren(page,item)):page.querySelector("#childrenCollapsible").classList.add("hide"),"Series"==item.Type&&renderSeriesSchedule(page,item,user),"Series"==item.Type?renderNextUp(page,item,user):page.querySelector(".nextUpSection").classList.add("hide"),item.MediaSources&&item.MediaSources.length&&renderMediaSources(page,item);var chapters=item.Chapters||[];chapters.length?(page.querySelector("#scenesCollapsible").classList.remove("hide"),renderScenes(page,item,user,3)):page.querySelector("#scenesCollapsible").classList.add("hide"),item.SpecialFeatureCount&&0!=item.SpecialFeatureCount&&"Series"!=item.Type?(page.querySelector("#specialsCollapsible").classList.remove("hide"),renderSpecials(page,item,user,6)):page.querySelector("#specialsCollapsible").classList.add("hide"),item.People&&item.People.length?(page.querySelector("#castCollapsible").classList.remove("hide"),renderCast(page,item,context,enableScrollX()?null:12)):page.querySelector("#castCollapsible").classList.add("hide"),item.PartCount&&item.PartCount>1?(page.querySelector("#additionalPartsCollapsible").classList.remove("hide"),renderAdditionalParts(page,item,user)):page.querySelector("#additionalPartsCollapsible").classList.add("hide"),page.querySelector("#themeSongsCollapsible").classList.add("hide"),page.querySelector("#themeVideosCollapsible").classList.add("hide"),"MusicAlbum"==item.Type?renderMusicVideos(page,item,user):page.querySelector("#musicVideosCollapsible").classList.add("hide"),renderThemeMedia(page,item,user),enableScrollX()?renderCriticReviews(page,item):renderCriticReviews(page,item,1)}function renderOverview(elems,item){for(var i=0,length=elems.length;i<length;i++){var elem=elems[i],overview=item.Overview||"";if(overview){elem.innerHTML=overview,elem.classList.remove("empty");for(var anchors=elem.querySelectorAll("a"),j=0,length2=anchors.length;j<length2;j++)anchors[j].setAttribute("target","_blank")}else elem.innerHTML="",elem.classList.add("empty")}}function renderDetails(page,item,context,isStatic){renderSimilarItems(page,item,context),renderMoreFromItems(page,item),isStatic||renderSiblingLinks(page,item,context);var taglineElement=page.querySelector(".tagline");item.Taglines&&item.Taglines.length?(taglineElement.classList.remove("hide"),taglineElement.innerHTML=item.Taglines[0]):taglineElement.classList.add("hide");var topOverview=page.querySelector(".topOverview"),bottomOverview=page.querySelector(".bottomOverview"),seasonOnBottom=screen.availHeight<800||screen.availWidth<600;"MusicAlbum"==item.Type||"MusicArtist"==item.Type||"Season"==item.Type&&seasonOnBottom?(renderOverview([bottomOverview],item),topOverview.classList.add("hide"),bottomOverview.classList.remove("hide")):(renderOverview([topOverview],item),topOverview.classList.remove("hide"),bottomOverview.classList.add("hide")),renderAwardSummary(page.querySelector("#awardSummary"),item);var i,length,itemMiscInfo=page.querySelectorAll(".itemMiscInfo");for(i=0,length=itemMiscInfo.length;i<length;i++)mediaInfo.fillPrimaryMediaInfo(itemMiscInfo[i],item,{interactive:!0,episodeTitle:!1});var itemGenres=page.querySelectorAll(".itemGenres");for(i=0,length=itemGenres.length;i<length;i++)renderGenres(itemGenres[i],item,null,isStatic);renderStudios(page.querySelector(".itemStudios"),item,isStatic),renderUserDataIcons(page,item),renderLinks(page.querySelector(".itemExternalLinks"),item),page.querySelector(".criticRatingScore").innerHTML=(item.CriticRating||"0")+"%",item.CriticRatingSummary?(page.querySelector("#criticRatingSummary").classList.remove("hide"),page.querySelector(".criticRatingSummaryText").innerHTML=item.CriticRatingSummary):page.querySelector("#criticRatingSummary").classList.add("hide"),renderTags(page,item),renderSeriesAirTime(page,item,isStatic);var playersElement=page.querySelector("#players");item.Players?(playersElement.classList.remove("hide"),playersElement.innerHTML=item.Players+" Player"):playersElement.classList.add("hide");var artist=page.querySelectorAll(".artist");for(i=0,length=artist.length;i<length;i++)item.ArtistItems&&item.ArtistItems.length&&"MusicAlbum"!=item.Type?(artist[i].classList.remove("hide"),artist[i].innerHTML=getArtistLinksHtml(item.ArtistItems,context)):artist[i].classList.add("hide");item.MediaSources&&item.MediaSources.length&&item.Path?page.querySelector(".audioVideoMediaInfo").classList.remove("hide"):page.querySelector(".audioVideoMediaInfo").classList.add("hide"),"Photo"==item.MediaType?(page.querySelector(".photoInfo").classList.remove("hide"),renderPhotoInfo(page,item)):page.querySelector(".photoInfo").classList.add("hide"),renderTabButtons(page,item)}function renderPhotoInfo(page,item){var html="",attributes=[];if(item.CameraMake&&attributes.push(createAttribute(Globalize.translate("MediaInfoCameraMake"),item.CameraMake)),item.CameraModel&&attributes.push(createAttribute(Globalize.translate("MediaInfoCameraModel"),item.CameraModel)),item.Altitude&&attributes.push(createAttribute(Globalize.translate("MediaInfoAltitude"),item.Altitude.toFixed(1))),item.Aperture&&attributes.push(createAttribute(Globalize.translate("MediaInfoAperture"),"F"+item.Aperture.toFixed(1))),item.ExposureTime){var val=1/item.ExposureTime;attributes.push(createAttribute(Globalize.translate("MediaInfoExposureTime"),"1/"+val+" s"))}item.FocalLength&&attributes.push(createAttribute(Globalize.translate("MediaInfoFocalLength"),item.FocalLength.toFixed(1)+" mm")),item.ImageOrientation,item.IsoSpeedRating&&attributes.push(createAttribute(Globalize.translate("MediaInfoIsoSpeedRating"),item.IsoSpeedRating)),item.Latitude&&attributes.push(createAttribute(Globalize.translate("MediaInfoLatitude"),item.Latitude.toFixed(1))),item.Longitude&&attributes.push(createAttribute(Globalize.translate("MediaInfoLongitude"),item.Longitude.toFixed(1))),item.ShutterSpeed&&attributes.push(createAttribute(Globalize.translate("MediaInfoShutterSpeed"),item.ShutterSpeed)),item.Software&&attributes.push(createAttribute(Globalize.translate("MediaInfoSoftware"),item.Software)),html+=attributes.join("<br/>"),page.querySelector(".photoInfoContent").innerHTML=html}function renderTabButtons(page,item){var elem=page.querySelector(".tabDetails"),text=elem.textContent||elem.innerText||"";text.trim()?page.querySelector(".detailsSection").classList.remove("hide"):page.querySelector(".detailsSection").classList.add("hide")}function getArtistLinksHtml(artists,context){for(var html=[],i=0,length=artists.length;i<length;i++){var artist=artists[i];html.push('<a class="textlink" href="itemdetails.html?id='+artist.Id+'">'+artist.Name+"</a>")}return html=html.join(" / "),1==artists.length?Globalize.translate("ValueArtist",html):artists.length>1?Globalize.translate("ValueArtists",html):html}function renderSiblingLinks(page,item,context){var lnkPreviousItem=page.querySelector(".lnkPreviousItem"),lnkNextItem=page.querySelector(".lnkNextItem");if("Episode"!=item.Type&&"Season"!=item.Type&&"Audio"!=item.Type&&"Photo"!=item.Type)return lnkNextItem.classList.add("hide"),void lnkPreviousItem.classList.add("hide");var promise;promise="Season"==item.Type?ApiClient.getSeasons(item.SeriesId,{userId:Dashboard.getCurrentUserId(),AdjacentTo:item.Id}):"Episode"==item.Type&&item.SeasonId?ApiClient.getEpisodes(item.SeriesId,{seasonId:item.SeasonId,userId:Dashboard.getCurrentUserId(),AdjacentTo:item.Id}):ApiClient.getItems(Dashboard.getCurrentUserId(),{AdjacentTo:item.Id,ParentId:item.ParentId,SortBy:"SortName"}),context=context||"",promise.then(function(result){for(var foundExisting=!1,i=0,length=result.Items.length;i<length;i++){var curr=result.Items[i];curr.Id==item.Id?foundExisting=!0:foundExisting?(lnkNextItem.classList.remove("hide"),lnkNextItem.href="itemdetails.html?id="+curr.Id+"&context="+context):(lnkPreviousItem.classList.remove("hide"),lnkPreviousItem.href="itemdetails.html?id="+curr.Id+"&context="+context)}})}function enableScrollX(){return browserInfo.mobile&&AppInfo.enableAppLayouts&&screen.availWidth<=1e3}function getPortraitShape(scrollX){return null==scrollX&&(scrollX=enableScrollX()),scrollX?"overflowPortrait":"portrait"}function getSquareShape(scrollX){return null==scrollX&&(scrollX=enableScrollX()),scrollX?"overflowSquare":"square"}function getThumbShape(scrollX){return null==scrollX&&(scrollX=enableScrollX()),scrollX?"overflowBackdrop":"backdrop"}function renderMoreFromItems(page,item){var moreFromSection=page.querySelector("#moreFromSection");if(moreFromSection)return"MusicAlbum"==item.Type&&item.AlbumArtists&&item.AlbumArtists.length?void ApiClient.getItems(Dashboard.getCurrentUserId(),{IncludeItemTypes:"MusicAlbum",ArtistIds:item.AlbumArtists[0].Id,Recursive:!0,ExcludeItemIds:item.Id}).then(function(result){if(!result.Items.length)return void moreFromSection.classList.add("hide");moreFromSection.classList.remove("hide"),moreFromSection.querySelector(".moreFromHeader").innerHTML=Globalize.translate("MoreFromValue",item.AlbumArtists[0].Name);var html="";html+=enableScrollX()?'<div is="emby-itemscontainer" class="hiddenScrollX itemsContainer">':'<div is="emby-itemscontainer" class="itemsContainer vertical-wrap">';var shape="MusicAlbum"==item.Type||"MusicArtist"==item.Type?getSquareShape():getPortraitShape(),supportsImageAnalysis=appHost.supports("imageanalysis");html+=cardBuilder.getCardsHtml({items:result.Items,shape:shape,showParentTitle:"MusicAlbum"==item.Type,centerText:!supportsImageAnalysis,showTitle:"MusicAlbum"==item.Type||"Game"==item.Type||"MusicArtist"==item.Type,coverImage:"MusicAlbum"==item.Type||"MusicArtist"==item.Type,overlayPlayButton:!0,cardLayout:supportsImageAnalysis,vibrant:supportsImageAnalysis}),html+="</div>";var similarContent=page.querySelector("#moreFromItems");similarContent.innerHTML=html,ImageLoader.lazyChildren(similarContent)}):void moreFromSection.classList.add("hide")}function renderSimilarItems(page,item,context){var similarCollapsible=page.querySelector("#similarCollapsible");if(similarCollapsible){if("Movie"!=item.Type&&"Trailer"!=item.Type&&"Series"!=item.Type&&"Program"!=item.Type&&"Recording"!=item.Type&&"Game"!=item.Type&&"MusicAlbum"!=item.Type&&"MusicArtist"!=item.Type&&"ChannelVideoItem"!=item.Type)return void similarCollapsible.classList.add("hide");similarCollapsible.classList.remove("hide");var shape="MusicAlbum"==item.Type||"MusicArtist"==item.Type?getSquareShape():getPortraitShape(),options={userId:Dashboard.getCurrentUserId(),limit:"MusicAlbum"==item.Type||"MusicArtist"==item.Type?8:10,fields:"PrimaryImageAspectRatio,UserData,CanDelete"};"MusicAlbum"==item.Type&&item.AlbumArtists&&item.AlbumArtists.length&&(options.ExcludeArtistIds=item.AlbumArtists[0].Id),enableScrollX()&&(options.limit=12),ApiClient.getSimilarItems(item.Id,options).then(function(result){if(!result.Items.length)return void similarCollapsible.classList.add("hide");similarCollapsible.classList.remove("hide");var html="";html+=enableScrollX()?'<div is="emby-itemscontainer" class="hiddenScrollX itemsContainer">':'<div is="emby-itemscontainer" class="itemsContainer vertical-wrap">';var supportsImageAnalysis=appHost.supports("imageanalysis"),cardLayout=supportsImageAnalysis&&("MusicAlbum"==item.Type||"Game"==item.Type||"MusicArtist"==item.Type);html+=cardBuilder.getCardsHtml({items:result.Items,shape:shape,showParentTitle:"MusicAlbum"==item.Type,centerText:!cardLayout,showTitle:"MusicAlbum"==item.Type||"Game"==item.Type||"MusicArtist"==item.Type,context:context,lazy:!0,showDetailsMenu:!0,coverImage:"MusicAlbum"==item.Type||"MusicArtist"==item.Type,overlayPlayButton:!0,cardLayout:cardLayout,vibrant:cardLayout&&supportsImageAnalysis}),html+="</div>";var similarContent=similarCollapsible.querySelector(".similarContent");similarContent.innerHTML=html,ImageLoader.lazyChildren(similarContent)})}}function renderSeriesAirTime(page,item,isStatic){var seriesAirTime=page.querySelector("#seriesAirTime");if("Series"!=item.Type)return void seriesAirTime.classList.add("hide");var html="";item.AirDays&&item.AirDays.length&&(html+=7==item.AirDays.length?"daily":item.AirDays.map(function(a){return a+"s"}).join(",")),item.AirTime&&(html+=" at "+item.AirTime),item.Studios.length&&(html+=isStatic?" on "+item.Studios[0].Name:' on <a class="textlink" href="itemdetails.html?id='+item.Studios[0].Id+'">'+item.Studios[0].Name+"</a>"),html?(html=("Ended"==item.Status?"Aired ":"Airs ")+html,seriesAirTime.innerHTML=html,seriesAirTime.classList.remove("hide")):seriesAirTime.classList.add("hide")}function renderTags(page,item){var itemTags=page.querySelector(".itemTags");if(item.Tags&&item.Tags.length){var html="";html+="<p>"+Globalize.translate("HeaderTags")+"</p>";for(var i=0,length=item.Tags.length;i<length;i++)html+='<div class="itemTag">'+item.Tags[i]+"</div>";itemTags.innerHTML=html,itemTags.classList.remove("hide")}else itemTags.classList.add("hide")}function getEpisodesFunction(seriesId,query){return query=Object.assign({},query),function(index,limit,fields){return query.StartIndex=index,query.Limit=limit,query.Fields=fields,ApiClient.getEpisodes(seriesId,query)}}function getAlbumSongsFunction(query){return query=Object.assign({},query),function(index,limit,fields){return query.StartIndex=index,query.Limit=limit,query.Fields=fields,ApiClient.getItems(Dashboard.getCurrentUserId(),query)}}function renderChildren(page,item){_childrenItemsFunction=null;var fields="ItemCounts,AudioInfo,PrimaryImageAspectRatio,BasicSyncInfo,CanDelete",query={ParentId:item.Id,Fields:fields};"BoxSet"!==item.Type&&(query.SortBy="SortName");var promise,userId=Dashboard.getCurrentUserId();"Series"==item.Type?promise=ApiClient.getSeasons(item.Id,{userId:userId,Fields:fields}):"Season"==item.Type?(promise=ApiClient.getEpisodes(item.SeriesId,{seasonId:item.Id,userId:userId,Fields:fields}),_childrenItemsFunction=getEpisodesFunction(item.SeriesId,{seasonId:item.Id,userId:userId,Fields:fields})):"MusicAlbum"==item.Type&&(_childrenItemsFunction=getAlbumSongsFunction(query)),promise=promise||ApiClient.getItems(Dashboard.getCurrentUserId(),query),promise.then(function(result){var html="",scrollX=!1,isList=!1;"MusicAlbum"==item.Type?(html=listView.getListViewHtml({items:result.Items,smallIcon:!0,showIndex:!0,index:"disc",showIndexNumber:!0,playFromHere:!0,action:"playallfromhere",image:!1,artist:!1}),isList=!0):"Series"==item.Type?(scrollX=enableScrollX(),html=cardBuilder.getCardsHtml({items:result.Items,shape:getPortraitShape(),showTitle:!0,centerText:!0,lazy:!0,overlayPlayButton:!0,allowBottomPadding:!scrollX})):"Season"==item.Type?html=cardBuilder.getCardsHtml({items:result.Items,shape:getThumbShape(!1),showTitle:!0,displayAsSpecial:"Season"==item.Type&&item.IndexNumber,playFromHere:!0,overlayText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}):"GameSystem"==item.Type&&(html=cardBuilder.getCardsHtml({items:result.Items,shape:"auto",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var elem=page.querySelector(".childrenItemsContainer");if(scrollX?(elem.classList.add("hiddenScrollX"),elem.classList.remove("vertical-wrap"),elem.classList.remove("vertical-list")):(elem.classList.remove("hiddenScrollX"),isList?(elem.classList.add("vertical-list"),elem.classList.remove("vertical-wrap")):(elem.classList.add("vertical-wrap"),elem.classList.remove("vertical-list"))),elem.innerHTML=html,ImageLoader.lazyChildren(elem),"BoxSet"==item.Type){var collectionItemTypes=[{name:Globalize.translate("HeaderMovies"),type:"Movie"},{name:Globalize.translate("HeaderSeries"),type:"Series"},{name:Globalize.translate("HeaderAlbums"),type:"MusicAlbum"},{name:Globalize.translate("HeaderGames"),type:"Game"},{name:Globalize.translate("HeaderBooks"),type:"Book"}];renderCollectionItems(page,item,collectionItemTypes,result.Items)}}),"Season"==item.Type?page.querySelector("#childrenTitle").innerHTML=Globalize.translate("HeaderEpisodes"):"Series"==item.Type?page.querySelector("#childrenTitle").innerHTML=Globalize.translate("HeaderSeasons"):"MusicAlbum"==item.Type?page.querySelector("#childrenTitle").innerHTML=Globalize.translate("HeaderTracks"):"GameSystem"==item.Type?page.querySelector("#childrenTitle").innerHTML=Globalize.translate("HeaderGames"):page.querySelector("#childrenTitle").innerHTML=Globalize.translate("HeaderItems"),"MusicAlbum"==item.Type?page.querySelector(".childrenSectionHeader",page).classList.add("hide"):page.querySelector(".childrenSectionHeader",page).classList.remove("hide")}function renderItemsByName(page,item,user){require("scripts/itembynamedetailpage".split(","),function(){window.ItemsByName.renderItems(page,item)})}function renderPlaylistItems(page,item,user){require("scripts/playlistedit".split(","),function(){PlaylistViewer.render(page,item)})}function renderChannelGuide(page,item,user){require("scripts/livetvchannel,scripts/livetvcomponents,livetvcss".split(","),function(liveTvChannelPage){liveTvChannelPage.renderPrograms(page,item.Id)})}function renderSeriesSchedule(page,item,user){}function renderStudios(elem,item,isStatic){if(item.Studios&&item.Studios.length&&"Series"!=item.Type){for(var html="",i=0,length=item.Studios.length;i<length;i++)i>0&&(html+="&nbsp;&nbsp;/&nbsp;&nbsp;"),html+=isStatic?item.Studios[i].Name:'<a class="textlink" href="itemdetails.html?id='+item.Studios[i].Id+'">'+item.Studios[i].Name+"</a>";var translationKey=item.Studios.length>1?"ValueStudios":"ValueStudio";html=Globalize.translate(translationKey,html),elem.innerHTML=html,elem.classList.remove("hide")}else elem.classList.add("hide")}function renderGenres(elem,item,limit,isStatic){for(var html="",genres=item.Genres||[],i=0,length=genres.length;i<length&&!(limit&&i>=limit);i++){i>0&&(html+="<span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>");var param="Audio"==item.Type||"MusicArtist"==item.Type||"MusicAlbum"==item.Type?"musicgenre":"genre";"Game"==item.MediaType&&(param="gamegenre"),html+=isStatic?genres[i]:'<a class="textlink" href="itemdetails.html?'+param+"="+ApiClient.encodeName(genres[i])+'">'+genres[i]+"</a>"}elem.innerHTML=html}function renderAwardSummary(elem,item){item.AwardSummary?(elem.classList.remove("hide"),elem.innerHTML=Globalize.translate("ValueAwards",item.AwardSummary)):elem.classList.add("hide")}function renderCollectionItems(page,parentItem,types,items){page.querySelector(".collectionItems").innerHTML="";var i,length;for(i=0,length=types.length;i<length;i++){var type=types[i],typeItems=items.filter(function(curr){return curr.Type==type.type});typeItems.length&&renderCollectionItemType(page,parentItem,type,typeItems)}var otherType={name:Globalize.translate("HeaderOtherItems")},otherTypeItems=items.filter(function(curr){return!types.filter(function(t){return t.type==curr.Type}).length});otherTypeItems.length&&renderCollectionItemType(page,parentItem,otherType,otherTypeItems),items.length||renderCollectionItemType(page,parentItem,{name:Globalize.translate("HeaderItems")},items)}function renderCollectionItemType(page,parentItem,type,items){var html="";html+='<div class="detailSection">',html+='<div style="display:flex;align-items:center;">',html+="<h1>",html+="<span>"+type.name+"</span>",html+="</h1>",html+='<button class="btnAddToCollection autoSize" type="button" is="paper-icon-button-light" style="margin-left:1em;"><i class="md-icon" icon="add">add</i></button>',html+="</div>",html+='<div is="emby-itemscontainer" class="detailSectionContent itemsContainer vertical-wrap">';var shape="MusicAlbum"==type.type?getSquareShape(!1):getPortraitShape(!1);html+=cardBuilder.getCardsHtml({items:items,shape:shape,showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0,overlayMoreButton:!0,showAddToCollection:!1,showRemoveFromCollection:!0,collectionId:parentItem.Id}),html+="</div>",html+="</div>";var collectionItems=page.querySelector(".collectionItems");collectionItems.insertAdjacentHTML("beforeend",html),ImageLoader.lazyChildren(collectionItems),collectionItems.querySelector(".btnAddToCollection").addEventListener("click",function(){require(["alert"],function(alert){alert({text:Globalize.translate("AddItemToCollectionHelp"),html:Globalize.translate("AddItemToCollectionHelp")+'<br/><br/><a target="_blank" href="https://github.com/MediaBrowser/Wiki/wiki/Collections">'+Globalize.translate("ButtonLearnMore")+"</a>"})})})}function renderUserDataIcons(page,item){for(var userDataIcons=page.querySelectorAll(".userDataIcons"),i=0,length=userDataIcons.length;i<length;i++)userdataButtons.fill({item:item,style:"fab-mini",element:userDataIcons[i]})}function renderCriticReviews(page,item,limit){if("Movie"!=item.Type&&"Trailer"!=item.Type&&"MusicVideo"!=item.Type)return void page.querySelector("#criticReviewsCollapsible").classList.add("hide");var options={};limit&&(options.limit=limit),ApiClient.getCriticReviews(item.Id,options).then(function(result){result.TotalRecordCount||item.CriticRatingSummary||item.AwardSummary?(page.querySelector("#criticReviewsCollapsible").classList.remove("hide"),renderCriticReviewsContent(page,result,limit)):page.querySelector("#criticReviewsCollapsible").classList.add("hide")})}function renderCriticReviewsContent(page,result,limit){for(var html="",reviews=result.Items,i=0,length=reviews.length;i<length;i++){var review=reviews[i];html+='<div class="paperList criticReviewPaperList">',html+='<div class="listItem">',null!=review.Score||null!=review.Likes&&(html+=review.Likes?"<div style=\"flex-shrink:0;background-color:transparent;background-image:url('css/images/fresh.png');background-repeat:no-repeat;background-position:center center;background-size: cover;width:40px;height:40px;\"></div>":"<div style=\"flex-shrink:0;background-color:transparent;background-image:url('css/images/rotten.png');background-repeat:no-repeat;background-position:center center;background-size: cover;width:40px;height:40px;\"></div>"),html+='<div class="listItemBody two-line">',html+='<h3 class="listItemBodyText" style="white-space:normal;">'+review.Caption+"</h3>";var vals=[];if(review.ReviewerName&&vals.push(review.ReviewerName),review.Publisher&&vals.push(review.Publisher),html+='<div class="secondary listItemBodyText">'+vals.join(", ")+".",review.Date)try{var date=datetime.parseISO8601Date(review.Date,!0).toLocaleDateString();html+='<span class="reviewDate">'+date+"</span>"}catch(error){}html+="</div>",review.Url&&(html+='<div class="secondary listItemBodyText"><a class="textlink" href="'+review.Url+'" target="_blank">'+Globalize.translate("ButtonFullReview")+"</a></div>"),html+="</div>",html+="</div>",html+="</div>"}limit&&result.TotalRecordCount>limit&&(html+='<p style="margin: 0;"><button is="emby-button" type="button" class="raised more moreCriticReviews">'+Globalize.translate("ButtonMore")+"</button></p>");var criticReviewsContent=page.querySelector("#criticReviewsContent");criticReviewsContent.innerHTML=html,enableScrollX()?criticReviewsContent.classList.add("hiddenScrollX"):criticReviewsContent.classList.remove("hiddenScrollX")}function renderThemeMedia(page,item){ApiClient.getThemeMedia(Dashboard.getCurrentUserId(),item.Id,!0).then(function(result){
var themeSongs=result.ThemeSongsResult.OwnerId==item.Id?result.ThemeSongsResult.Items:[],themeVideos=result.ThemeVideosResult.OwnerId==item.Id?result.ThemeVideosResult.Items:[];renderThemeSongs(page,themeSongs),renderThemeVideos(page,themeVideos)})}function renderThemeSongs(page,items){if(items.length){page.querySelector("#themeSongsCollapsible").classList.remove("hide");var html=listView.getListViewHtml({items:items});page.querySelector("#themeSongsContent").innerHTML=html}else page.querySelector("#themeSongsCollapsible").classList.add("hide")}function renderThemeVideos(page,items,user){if(items.length){page.querySelector("#themeVideosCollapsible").classList.remove("hide");var themeVideosContent=page.querySelector("#themeVideosContent");themeVideosContent.innerHTML=getVideosHtml(items,user),ImageLoader.lazyChildren(themeVideosContent)}else page.querySelector("#themeVideosCollapsible").classList.add("hide")}function renderMusicVideos(page,item,user){ApiClient.getItems(user.Id,{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:!0,Fields:"DateCreated,CanDelete",Albums:item.Name}).then(function(result){if(result.Items.length){page.querySelector("#musicVideosCollapsible").classList.remove("hide");var musicVideosContent=page.querySelector(".musicVideosContent");musicVideosContent.innerHTML=getVideosHtml(result.Items,user),ImageLoader.lazyChildren(musicVideosContent)}else page.querySelector("#musicVideosCollapsible").classList.add("hide")})}function renderAdditionalParts(page,item,user){ApiClient.getAdditionalVideoParts(user.Id,item.Id).then(function(result){if(result.Items.length){page.querySelector("#additionalPartsCollapsible").classList.remove("hide");var additionalPartsContent=page.querySelector("#additionalPartsContent");additionalPartsContent.innerHTML=getVideosHtml(result.Items,user),ImageLoader.lazyChildren(additionalPartsContent)}else page.querySelector("#additionalPartsCollapsible").classList.add("hide")})}function renderScenes(page,item,user,limit,isStatic){var chapters=item.Chapters||[],scenesContent=page.querySelector("#scenesContent");enableScrollX()?(scenesContent.classList.add("smoothScrollX"),limit=null):scenesContent.classList.add("vertical-wrap");var limitExceeded=limit&&chapters.length>limit;limitExceeded&&(chapters=chapters.slice(0),chapters.length=Math.min(limit,chapters.length)),require(["chaptercardbuilder"],function(chaptercardbuilder){chaptercardbuilder.buildChapterCards(item,chapters,{itemsContainer:scenesContent,coverImage:!0,width:400,backdropShape:getThumbShape(),squareShape:getSquareShape()})});var moreScenesButton=page.querySelector(".moreScenes");moreScenesButton&&(limitExceeded?moreScenesButton.classList.remove("hide"):moreScenesButton.classList.add("hide"))}function renderMediaSources(page,item){var html=item.MediaSources.map(function(v){return getMediaSourceHtml(item,v)}).join('<div style="border-top:1px solid #444;margin: 1em 0;"></div>');item.MediaSources.length>1&&(html="<br/>"+html);var mediaInfoContent=page.querySelector("#mediaInfoContent");mediaInfoContent.innerHTML=html}function getMediaSourceHtml(item,version){var html="";version.Name&&item.MediaSources.length>1&&(html+='<div><span class="mediaInfoAttribute">'+version.Name+"</span></div><br/>");for(var i=0,length=version.MediaStreams.length;i<length;i++){var stream=version.MediaStreams[i];if("Data"!=stream.Type){html+='<div class="mediaInfoStream">';var displayType=Globalize.translate("MediaInfoStreamType"+stream.Type);html+='<h3 class="mediaInfoStreamType">'+displayType+"</h3>";var attributes=[];stream.Language&&"Video"!=stream.Type&&attributes.push(createAttribute(Globalize.translate("MediaInfoLanguage"),stream.Language)),stream.Codec&&attributes.push(createAttribute(Globalize.translate("MediaInfoCodec"),stream.Codec.toUpperCase())),stream.CodecTag&&attributes.push(createAttribute(Globalize.translate("MediaInfoCodecTag"),stream.CodecTag)),null!=stream.IsAVC&&attributes.push(createAttribute("AVC",stream.IsAVC?"Yes":"No")),stream.Profile&&attributes.push(createAttribute(Globalize.translate("MediaInfoProfile"),stream.Profile)),stream.Level&&attributes.push(createAttribute(Globalize.translate("MediaInfoLevel"),stream.Level)),(stream.Width||stream.Height)&&attributes.push(createAttribute(Globalize.translate("MediaInfoResolution"),stream.Width+"x"+stream.Height)),stream.AspectRatio&&"mjpeg"!=stream.Codec&&attributes.push(createAttribute(Globalize.translate("MediaInfoAspectRatio"),stream.AspectRatio)),"Video"==stream.Type&&(null!=stream.IsAnamorphic&&attributes.push(createAttribute(Globalize.translate("MediaInfoAnamorphic"),stream.IsAnamorphic?"Yes":"No")),attributes.push(createAttribute(Globalize.translate("MediaInfoInterlaced"),stream.IsInterlaced?"Yes":"No"))),(stream.AverageFrameRate||stream.RealFrameRate)&&attributes.push(createAttribute(Globalize.translate("MediaInfoFramerate"),stream.AverageFrameRate||stream.RealFrameRate)),stream.ChannelLayout&&attributes.push(createAttribute(Globalize.translate("MediaInfoLayout"),stream.ChannelLayout)),stream.Channels&&attributes.push(createAttribute(Globalize.translate("MediaInfoChannels"),stream.Channels+" ch")),stream.BitRate&&"mjpeg"!=stream.Codec&&attributes.push(createAttribute(Globalize.translate("MediaInfoBitrate"),parseInt(stream.BitRate/1e3)+" kbps")),stream.SampleRate&&attributes.push(createAttribute(Globalize.translate("MediaInfoSampleRate"),stream.SampleRate+" Hz")),stream.BitDepth&&attributes.push(createAttribute(Globalize.translate("MediaInfoBitDepth"),stream.BitDepth+" bit")),stream.PixelFormat&&attributes.push(createAttribute(Globalize.translate("MediaInfoPixelFormat"),stream.PixelFormat)),stream.RefFrames&&attributes.push(createAttribute(Globalize.translate("MediaInfoRefFrames"),stream.RefFrames)),stream.NalLengthSize&&attributes.push(createAttribute("NAL",stream.NalLengthSize)),"Video"!=stream.Type&&attributes.push(createAttribute(Globalize.translate("MediaInfoDefault"),stream.IsDefault?"Yes":"No")),"Subtitle"==stream.Type&&(attributes.push(createAttribute(Globalize.translate("MediaInfoForced"),stream.IsForced?"Yes":"No")),attributes.push(createAttribute(Globalize.translate("MediaInfoExternal"),stream.IsExternal?"Yes":"No"))),"Video"==stream.Type&&version.Timestamp&&attributes.push(createAttribute(Globalize.translate("MediaInfoTimestamp"),version.Timestamp)),stream.DisplayTitle&&attributes.push(createAttribute("Title",stream.DisplayTitle)),html+=attributes.join("<br/>"),html+="</div>"}}if(version.Container&&(html+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoContainer")+'</span><span class="mediaInfoAttribute">'+version.Container+"</span></div>"),version.Formats&&version.Formats.length,version.Path&&"Http"!=version.Protocol&&(html+='<div style="max-width:600px;overflow:hidden;"><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoPath")+'</span><span class="mediaInfoAttribute">'+version.Path+"</span></div>"),version.Size){var size=(version.Size/1048576).toFixed(0);html+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoSize")+'</span><span class="mediaInfoAttribute">'+size+" MB</span></div>"}return html}function createAttribute(label,value){return'<span class="mediaInfoLabel">'+label+'</span><span class="mediaInfoAttribute">'+value+"</span>"}function getVideosHtml(items,user,limit,moreButtonClass){var html=cardBuilder.getCardsHtml({items:items,shape:"auto",showTitle:!0,action:"play",overlayText:!0,showRuntime:!0});return limit&&items.length>limit&&(html+='<p style="margin: 0;padding-left:5px;"><button is="emby-button" type="button" class="raised more '+moreButtonClass+'">'+Globalize.translate("ButtonMore")+"</button></p>"),html}function renderSpecials(page,item,user,limit){ApiClient.getSpecialFeatures(user.Id,item.Id).then(function(specials){var specialsContent=page.querySelector("#specialsContent");specialsContent.innerHTML=getVideosHtml(specials,user,limit,"moreSpecials"),ImageLoader.lazyChildren(specialsContent)})}function renderCast(page,item,context,limit,isStatic){var people=item.People||[],castContent=page.querySelector("#castContent");enableScrollX()?(castContent.classList.add("smoothScrollX"),limit=32):castContent.classList.add("vertical-wrap");var limitExceeded=limit&&people.length>limit;limitExceeded&&(people=people.slice(0),people.length=Math.min(limit,people.length)),require(["peoplecardbuilder"],function(peoplecardbuilder){peoplecardbuilder.buildPeopleCards(people,{itemsContainer:castContent,coverImage:!0,serverId:item.ServerId,width:160,shape:getPortraitShape()})});var morePeopleButton=page.querySelector(".morePeople");morePeopleButton&&(limitExceeded&&!enableScrollX()?morePeopleButton.classList.remove("hide"):morePeopleButton.classList.add("hide"))}function play(startPosition){MediaController.play({items:[currentItem],startPositionTicks:startPosition})}function splitVersions(page,params){require(["confirm"],function(confirm){confirm("Are you sure you wish to split the media sources into separate items?","Split Media Apart").then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Videos/"+params.id+"/AlternateSources")}).then(function(){Dashboard.hideLoadingMsg(),reload(page,params)})})})}function playTrailer(page){ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),currentItem.Id).then(function(trailers){MediaController.play({items:trailers})})}function showPlayMenu(item,target){require(["playMenu"],function(playMenu){playMenu.show({item:item,positionTo:target})})}function playCurrentItem(button){return"Program"==currentItem.Type?void ApiClient.getLiveTvChannel(currentItem.ChannelId,Dashboard.getCurrentUserId()).then(function(channel){showPlayMenu(channel,button)}):void showPlayMenu(currentItem,button)}function itemDetailPage(){var self=this;self.play=play,self.setInitialCollapsibleState=setInitialCollapsibleState,self.renderDetails=renderDetails,self.renderCriticReviews=renderCriticReviews,self.renderCast=renderCast,self.renderScenes=renderScenes,self.renderMediaSources=renderMediaSources}function onPlayClick(){playCurrentItem(this)}function onSyncClick(){require(["syncDialog"],function(syncDialog){syncDialog.showMenu({items:[currentItem],serverId:ApiClient.serverId()})})}var currentItem,currentRecordingFields,_childrenItemsFunction=null;return window.ItemDetailPage=new itemDetailPage,function(view,params){function resetSyncStatus(){updateSyncStatus(view,currentItem)}function onSyncLocalClick(){this.checked?require(["syncDialog"],function(syncDialog){syncDialog.showMenu({items:[currentItem],isLocalSync:!0,serverId:ApiClient.serverId()}).then(function(){reload(view,params)},resetSyncStatus)}):require(["confirm"],function(confirm){confirm(Globalize.translate("ConfirmRemoveDownload")).then(function(){ApiClient.cancelSyncItems([currentItem.Id])},resetSyncStatus)})}function onPlayTrailerClick(){playTrailer(view)}function onMoreCommandsClick(){var button=this;itemContextMenu.show(getContextMenuOptions(currentItem,button)).then(function(result){result.deleted?Emby.Page.goHome():result.updated&&reload(view,params)})}function editImages(){return new Promise(function(resolve,reject){require(["imageEditor"],function(imageEditor){imageEditor.show({itemId:currentItem.Id,serverId:currentItem.ServerId}).then(resolve,reject)})})}function onWebSocketMessage(e,data){var msg=data;if("UserDataChanged"===msg.MessageType&&currentItem&&msg.Data.UserId==Dashboard.getCurrentUserId()){var key=currentItem.UserData.Key,userData=msg.Data.UserDataList.filter(function(u){return u.Key==key})[0];userData&&(currentItem.UserData=userData,Dashboard.getCurrentUser().then(function(user){refreshImage(view,currentItem,user)}))}}var i,length,elems=view.querySelectorAll(".btnPlay");for(i=0,length=elems.length;i<length;i++)elems[i].addEventListener("click",onPlayClick);for(elems=view.querySelectorAll(".btnPlayTrailer"),i=0,length=elems.length;i<length;i++)elems[i].addEventListener("click",onPlayTrailerClick);for(view.querySelector(".btnSplitVersions").addEventListener("click",function(){splitVersions(view,params)}),elems=view.querySelectorAll(".btnSync"),i=0,length=elems.length;i<length;i++)elems[i].addEventListener("click",onSyncClick);for(elems=view.querySelectorAll(".chkOffline"),i=0,length=elems.length;i<length;i++)elems[i].addEventListener("change",onSyncLocalClick);for(elems=view.querySelectorAll(".btnMoreCommands"),i=0,length=elems.length;i<length;i++)elems[i].addEventListener("click",onMoreCommandsClick);view.addEventListener("click",function(e){dom.parentWithClass(e.target,"moreScenes")?Dashboard.getCurrentUser().then(function(user){renderScenes(view,currentItem,user)}):dom.parentWithClass(e.target,"morePeople")?renderCast(view,currentItem,params.context):dom.parentWithClass(e.target,"moreSpecials")?Dashboard.getCurrentUser().then(function(user){renderSpecials(view,currentItem,user)}):dom.parentWithClass(e.target,"moreCriticReviews")&&renderCriticReviews(view,currentItem)}),view.querySelector(".collectionItems").addEventListener("needsrefresh",function(e){renderChildren(view,currentItem)}),view.querySelector(".detailImageContainer").addEventListener("click",function(e){var itemDetailGalleryLink=dom.parentWithClass(e.target,"itemDetailGalleryLink");itemDetailGalleryLink&&editImages().then(function(){reload(view,params)})}),view.addEventListener("viewbeforeshow",function(){var page=this;reload(page,params),Events.on(ApiClient,"websocketmessage",onWebSocketMessage)}),view.addEventListener("viewbeforehide",function(){currentItem=null,currentRecordingFields=null,Events.off(ApiClient,"websocketmessage",onWebSocketMessage),LibraryMenu.setTransparentMenu(!1)})}});
define(["jQuery","fnchecked"],function($){function load(page,config,allCultures,allCountries){config&&allCultures&&allCountries&&(page.querySelector("#chkEnableInternetProviders").checked=config.EnableInternetProviders,page.querySelector("#chkSaveLocal").checked=config.SaveLocalMeta,$("#selectLanguage",page).val(config.PreferredMetadataLanguage),$("#selectCountry",page).val(config.MetadataCountryCode),Dashboard.hideLoadingMsg())}function onSubmit(){var form=this;return Dashboard.showLoadingMsg(),ApiClient.getServerConfiguration().then(function(config){config.EnableInternetProviders=form.querySelector("#chkEnableInternetProviders").checked,config.SaveLocalMeta=form.querySelector("#chkSaveLocal").checked,config.PreferredMetadataLanguage=$("#selectLanguage",form).val(),config.MetadataCountryCode=$("#selectCountry",form).val(),ApiClient.updateServerConfiguration(config).then(function(){Dashboard.processServerConfigurationUpdateResult(),showConfirmMessage(config)})}),!1}function showConfirmMessage(config){var msg=[];msg.push(Globalize.translate("MetadataSettingChangeHelp")),config.DownloadImagesInAdvance&&msg.push(Globalize.translate("DownloadImagesInAdvanceWarning")),msg.length&&require(["alert"],function(alert){alert({text:msg.join("<br/><br/>")})})}function getTabs(){return[{href:"metadata.html",name:Globalize.translate("TabSettings")},{href:"metadataimages.html",name:Globalize.translate("TabServices")},{href:"metadatanfo.html",name:Globalize.translate("TabNfoSettings")}]}$(document).on("pageinit","#metadataConfigurationPage",function(){Dashboard.showLoadingMsg(),$(".metadataConfigurationForm").off("submit",onSubmit).on("submit",onSubmit)}).on("pageshow","#metadataConfigurationPage",function(){function populateLanguages(select,languages){var html="";html+="<option value=''></option>";for(var i=0,length=languages.length;i<length;i++){var culture=languages[i];html+="<option value='"+culture.TwoLetterISOLanguageName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html}function populateCountries(select,allCountries){var html="";html+="<option value=''></option>";for(var i=0,length=allCountries.length;i<length;i++){var culture=allCountries[i];html+="<option value='"+culture.TwoLetterISORegionName+"'>"+culture.DisplayName+"</option>"}select.innerHTML=html}LibraryMenu.setTabs("metadata",0,getTabs),Dashboard.showLoadingMsg();var config,allCultures,allCountries,page=this;ApiClient.getServerConfiguration().then(function(result){config=result,load(page,config,allCultures,allCountries)}),ApiClient.getCultures().then(function(result){populateLanguages(page.querySelector("#selectLanguage"),result),allCultures=result,load(page,config,allCultures,allCountries)}),ApiClient.getCountries().then(function(result){populateCountries(page.querySelector("#selectCountry"),result),allCountries=result,load(page,config,allCultures,allCountries)})})});
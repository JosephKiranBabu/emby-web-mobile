define(["appStorage","shell"],function(appStorage,shell){function validatePlayback(resolve,reject){Dashboard.getPluginSecurityInfo().then(function(pluginSecurityInfo){if(pluginSecurityInfo.IsMBSupporter)resolve();else{var lastMessage=parseInt(appStorage.getItem(supporterPlaybackKey)||"0");lastMessage?(new Date).getTime()-lastMessage>2592e5?showPlaybackOverlay(resolve,reject):resolve():(appStorage.setItem(supporterPlaybackKey,(new Date).getTime()),resolve())}})}function getSubscriptionBenefits(){var list=[];return list.push({name:Globalize.translate("CoverArt"),icon:"photo",text:Globalize.translate("CoverArtFeatureDescription")}),list.push({name:Globalize.translate("HeaderFreeApps"),icon:"check",text:Globalize.translate("FreeAppsFeatureDescription")}),Dashboard.capabilities().SupportsSync?list.push({name:Globalize.translate("HeaderMobileSync"),icon:"sync",text:Globalize.translate("MobileSyncFeatureDescription")}):list.push({name:Globalize.translate("HeaderCinemaMode"),icon:"movie",text:Globalize.translate("CinemaModeFeatureDescription")}),list}function getSubscriptionBenefitHtml(item){var html="";return html+='<div class="listItem">',html+='<i class="listItemIcon md-icon">'+item.icon+"</i>",html+='<div class="listItemBody two-line">',html+='<a class="clearLink" href="https://emby.media/premiere" target="_blank">',html+='<h3 class="listItemBodyText">',html+=item.name,html+="</h3>",html+='<div class="listItemBodyText secondary" style="white-space:normal;">',html+=item.text,html+="</div>",html+="</a>",html+="</div>",html+="</div>"}function showPlaybackOverlay(resolve,reject){require(["dialogHelper","listViewStyle","emby-button","formDialogStyle"],function(dialogHelper){var dlg=dialogHelper.createDialog({size:"fullscreen-border",removeOnClose:!0,scrollY:!1});dlg.classList.add("formDialog");var html="";html+='<div class="formDialogHeader">',html+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>',html+='<h3 class="formDialogHeaderTitle">',html+="</h3>",html+="</div>",html+='<div class="formDialogContent smoothScrollY">',html+='<div class="dialogContentInner dialog-content-centered">',html+="<h1>"+Globalize.translate("HeaderTryEmbyPremiere")+"</h1>",html+="<p>"+Globalize.translate("MessageDidYouKnowCinemaMode")+"</p>",html+="<p>"+Globalize.translate("MessageDidYouKnowCinemaMode2")+"</p>",html+="<br/>",html+="<h1>"+Globalize.translate("HeaderBenefitsEmbyPremiere")+"</h1>",html+='<div class="paperList">',html+=getSubscriptionBenefits().map(getSubscriptionBenefitHtml).join(""),html+="</div>",html+="<br/>",html+='<a class="clearLink" href="http://emby.media/premiere" target="_blank"><button is="emby-button" type="button" class="raised button-submit block" autoFocus><span>'+Globalize.translate("ButtonBecomeSupporter")+"</span></button></a>",html+='<button is="emby-button" type="button" class="raised subdued block btnCancelSupporterInfo" style="background:#444;"><span>'+Globalize.translate("ButtonClosePlayVideo")+"</span></button>",html+="</div>",html+="</div>",dlg.innerHTML=html,dlg.addEventListener("close",function(e){appStorage.setItem(supporterPlaybackKey,(new Date).getTime()),resolve()}),dialogHelper.open(dlg);var i,length,onCancelClick=function(){dialogHelper.close(dlg)},elems=dlg.querySelectorAll(".btnCancelSupporterInfo");for(i=0,length=elems.length;i<length;i++)elems[i].addEventListener("click",onCancelClick)})}function validateSync(resolve,reject){Dashboard.getPluginSecurityInfo().then(function(pluginSecurityInfo){return pluginSecurityInfo.IsMBSupporter?void resolve():(Dashboard.showLoadingMsg(),void ApiClient.getRegistrationInfo("Sync").then(function(registrationInfo){return Dashboard.hideLoadingMsg(),registrationInfo.IsRegistered?void resolve():void Dashboard.alert({message:Globalize.translate("HeaderSyncRequiresSupporterMembership")+'<br/><p><a href="http://emby.media/premiere" target="_blank">'+Globalize.translate("ButtonLearnMore")+"</a></p>",title:Globalize.translate("HeaderSync"),callback:reject})},function(){reject(),Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("ErrorValidatingSupporterInfo")})}))})}var supporterPlaybackKey="lastSupporterPlaybackMessage4";return{validateFeature:function(name){return new Promise(function(resolve,reject){"playback"==name?validatePlayback(resolve,reject):"livetv"==name?resolve():"sync"==name?validateSync(resolve,reject):resolve()})},showPremiereInfo:function(){shell.openUrl("https://emby.media/premiere")}}});